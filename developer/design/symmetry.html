<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Designing the Symmetry Component &mdash; TensorWrapper 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Tensor Sparsity Design" href="sparsity.html" />
    <link rel="prev" title="Tensor Shape Design" href="shape.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../background/index.html">TensorWrapper Background</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Design of TensorWrapper</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="motivation.html">Motivating TensorWrapper</a></li>
<li class="toctree-l3"><a class="reference internal" href="overview.html">Overview of TensorWrapper</a></li>
<li class="toctree-l3"><a class="reference internal" href="shape.html">Tensor Shape Design</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Designing the Symmetry Component</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-is-tensor-symmetry">What is (tensor) symmetry?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#why-do-we-need-to-consider-symmetry">Why do we need to consider symmetry?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#symmetry-considerations">Symmetry Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#symmetry-design">Symmetry Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="#proposed-apis">Proposed APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-notes">Additional Notes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sparsity.html">Tensor Sparsity Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="layout.html">Designing the Layout Component</a></li>
<li class="toctree-l3"><a class="reference internal" href="allocator.html">Designing the Allocator</a></li>
<li class="toctree-l3"><a class="reference internal" href="buffer.html">Designing the Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensor_wrapper.html">Designing <code class="docutils literal notranslate"><span class="pre">TensorWrapper</span></code> Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="expression.html">Designing the Expression Component</a></li>
<li class="toctree-l3"><a class="reference internal" href="op_graph.html">Designing the OpGraph</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparse_maps.html">Designing the Sparse Map Component</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../sparse_maps/index.html">Sparse Maps Sublibrary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bibliography/bibliography.html">References</a></li>
<li class="toctree-l1"><a class="reference external" href="https://nwchemex-project.github.io/TensorWrapper/tensorwrapper_cxx_api/index.html">C++ API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TensorWrapper</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Developer Documentation</a></li>
          <li class="breadcrumb-item"><a href="index.html">Design of TensorWrapper</a></li>
      <li class="breadcrumb-item active">Designing the Symmetry Component</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/NWChemEx-Project/TensorWrapper/edit/master/docs/source/developer/design/symmetry.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="designing-the-symmetry-component">
<span id="tw-designing-the-symmetry-component"></span><h1>Designing the Symmetry Component<a class="headerlink" href="#designing-the-symmetry-component" title="Permalink to this heading"></a></h1>
<p>The point of this page is to capture the considerations which went into
designing the symmetry component of TensorWrapper.</p>
<div class="section" id="what-is-tensor-symmetry">
<h2>What is (tensor) symmetry?<a class="headerlink" href="#what-is-tensor-symmetry" title="Permalink to this heading"></a></h2>
<p>Consider a matrix <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>, we say <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> has symmetry if given element <span class="math notranslate nohighlight">\(t_{ij}\)</span> we know
the value of a different element of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>, say <span class="math notranslate nohighlight">\(t_{ab}\)</span>. One of the more common types
of symmetry is when <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> is a symmetric matrix, in which case
<span class="math notranslate nohighlight">\(t_{ij} = t_{ab} = t_{ji}\)</span>.</p>
<p>For our purposes, given a tensor <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>, a symmetry <span class="math notranslate nohighlight">\(S\)</span> is a mapping of the
elements comprising a slice of <span class="math notranslate nohighlight">\(\mathbf{T}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{t}\)</span>, to those same elements (up to a sign)
in another slice <span class="math notranslate nohighlight">\(\mathbf{t'}\)</span>. We are specifically interested in non-trivial mappings
where <span class="math notranslate nohighlight">\(\mathbf{t}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{t'}\)</span> are not given by the same offsets. In the common scenario of
permutational symmetry, <span class="math notranslate nohighlight">\(\mathbf{t}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{t'}\)</span> will be slices containing a single element,
but for other symmetries <span class="math notranslate nohighlight">\(\mathbf{t}\)</span> may contain more
than one element. Strictly speaking <span class="math notranslate nohighlight">\(\mathbf{t}=\mathbf{0}\)</span> satisfies
our definition of a symmetry; however, such symmetries are usually treated
differently on account of the special properties of zero (namely its trivial
multiplication and addition). The case when <span class="math notranslate nohighlight">\(\mathbf{t}=\mathbf{0}\)</span> is
usually referred to as “sparsity” and is considered in <a class="reference internal" href="sparsity.html#sparsity-design"><span class="std std-ref">Tensor Sparsity Design</span></a>.</p>
</div>
<div class="section" id="why-do-we-need-to-consider-symmetry">
<h2>Why do we need to consider symmetry?<a class="headerlink" href="#why-do-we-need-to-consider-symmetry" title="Permalink to this heading"></a></h2>
<p>Performance. While we can always fill the tensor with the symmetrically
equivalent elements and then subject the tensor to standard tensor operations
without symmetry,
doing so leads to a lot of wasted memory and also leads to a large amount of
redundant work. By understanding the symmetry of the tensor we can avoid
this additional work.</p>
</div>
<div class="section" id="symmetry-considerations">
<h2>Symmetry Considerations<a class="headerlink" href="#symmetry-considerations" title="Permalink to this heading"></a></h2>
<dl class="simple" id="sym-symmetric-and-antisymmetric">
<dt>Symmetric and antisymmetric</dt><dd><p>As far as we know, permutational symmetry is the most common type of tensor
symmetry. Permutational symmetry occurs when the symmetry operation maps
the input slice to an output slice with the same indices just permuted. A
common example is a symmetric matrix where an element <span class="math notranslate nohighlight">\(t_{ij}\)</span> is equal to
<span class="math notranslate nohighlight">\(t_{ji}\)</span>.</p>
<ul class="simple">
<li><p>In tensors with rank greater than 2, symmetric/antisymmetric modes are
sorted into sets. The full set of symmetry equivalent elements is generated
by considering all possible permutations of the set.</p></li>
<li><p>Sets of symmetric/antisymmetric modes are not necessarily disjoint;
however, no pair of modes can appear in more than one set.</p></li>
<li><p>Generalizes to Hermitian/anti-Hermitian  if elements are complex.</p></li>
<li><p>The same tensor can have both symmetric and antisymmetric modes.</p></li>
<li><p>Pairwise mode permutations are most common, but it is also possible that
permutations must be ternary (<em>e.g.</em>, cyclic permutations of three-
dimensional space) or higher.</p></li>
</ul>
</dd>
</dl>
<dl class="simple" id="sym-translational-symmetry">
<dt>Translational symmetry</dt><dd><p>As a disclaimer, we could not find a name for this sort of tensor symmetry
and thus coined our own. Thinking of a tensor as a series of tiles,
symmetries occur when any of those tiles are the same. If we only stored
one copy of each symmetry unique tile, we could then form the entire tensor
by translating the symmetry unique tiles to each of the symmetry redundant
positions. For permutational symmetry, the indices of the symmetry redundant
tiles must be the same as the the indices of the symmetry unique tile, up
to a permutation. However, our translation algorithm suggests that in
general other translations will be needed, specifically translations where
the input and output indices are not related by permutations. We term such
symmetries as translational.</p>
<ul class="simple">
<li><p>Can arise when basis vectors are products and the value of the tensor’s
elements only depend on part of the basis vector.</p></li>
<li><p>In general are specified by providing the input slice and the output
slice.</p></li>
</ul>
</dd>
</dl>
<dl class="simple" id="sym-basic-properties">
<dt>Basic properties</dt><dd><p>Users interacting with classes in the symmetry component will want access to:</p>
<ul class="simple">
<li><p>Which elements are symmetry unique/redundant.</p></li>
<li><p>Whether an element is symmetry unique/redundant.</p></li>
<li><p>For a given shape, how many elements are symmetry unique/redundant.</p></li>
<li><p>The sign of the resulting element.</p></li>
</ul>
</dd>
</dl>
<dl class="simple" id="sym-composition">
<dt>Composition</dt><dd><p>When combining two tensors <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{B}\)</span> to form <span class="math notranslate nohighlight">\(\mathbf{C}\)</span>, the symmetry of <span class="math notranslate nohighlight">\(\mathbf{C}\)</span> is
determined from the symmetry of <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{B}\)</span>. The symmetry component should
be able to compose symmetries using Einstein notation, just like the
tensors the symmetries describe.</p>
</dd>
</dl>
<div class="section" id="out-of-scope-considerations">
<h3>Out of Scope Considerations<a class="headerlink" href="#out-of-scope-considerations" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt>Sparsity</dt><dd><p>Based on our definition of symmetry, sparsity is a symmetry; however, users
typically think of it differently, plus it internally is used differently.
For these reasons we consider sparsity separately from symmetry. For full
design details of the sparsity component see <a class="reference internal" href="sparsity.html#sparsity-design"><span class="std std-ref">Tensor Sparsity Design</span></a>.</p>
</dd>
<dt>Exploiting symmetry</dt><dd><p>The point of the symmetry component is to provide the user a mechanism for
expressing the symmetry of the tensor. Choosing what elements to store is
part of the physical layout (see <a class="reference internal" href="layout.html#layout-design"><span class="std std-ref">Designing the Layout Component</span></a>) and actually
exploiting the symmetry of the tensor is left to the backend.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="symmetry-design">
<h2>Symmetry Design<a class="headerlink" href="#symmetry-design" title="Permalink to this heading"></a></h2>
<div class="figure align-center" id="id1">
<span id="fig-symmetry"></span><img alt="../../_images/symmetry.png" src="../../_images/symmetry.png" />
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">The major classes involved in the symmetry component.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</div>
<p><a class="reference internal" href="#fig-symmetry"><span class="std std-numref">Fig. 5</span></a> shows the classes primarily responsible for defining
the symmetry component. Ultimately the user assembles a <code class="docutils literal notranslate"><span class="pre">Symmetry</span></code> object,
which describes all of the tensor’s overall symmetries. It is the <code class="docutils literal notranslate"><span class="pre">Symmetry</span></code>
object which is used by the rest of TensorWrapper. The remaining classes of
the <code class="docutils literal notranslate"><span class="pre">Symmetry</span></code> class hierarchy exist primarily to help the user create the
<code class="docutils literal notranslate"><span class="pre">Symmetry</span></code> object in a straightforward manner.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TotallySymmetric</span></code> allows a user to declare a tensor as totally symmetric
simply by providing the rank of the tensor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TotallyAntiSymmetric</span></code> allows a user to declare a tensor as totally
antisymmetric simply by providing the rank of the tensor.</p></li>
</ul>
<p>Ultimately the symmetry of a tensor is mathematically treated using group
theory. The symmetry operations on the tensor being the members of the group.
<code class="docutils literal notranslate"><span class="pre">Symmetry</span></code> is thus a container filled with <code class="docutils literal notranslate"><span class="pre">SymmetryOp</span></code> objects.
All symmetry operations derive from <code class="docutils literal notranslate"><span class="pre">SymmetryOp</span></code>, which serves primarily to
provided a consistent API among the various operations and to provide some
code factorization.</p>
<p>Of the symmetry operations provided by TensorWrapper, <code class="docutils literal notranslate"><span class="pre">Asymmetric</span></code> is the
simplest. By creating an instance of <code class="docutils literal notranslate"><span class="pre">Asymmetric</span></code>, the user is stating that
the modes in the resulting object exhibit no symmetry among themselves.
<code class="docutils literal notranslate"><span class="pre">Asymmetric</span></code> exists primarily to contrast with the other symmetry operations
and is assumed by default.</p>
<p><code class="docutils literal notranslate"><span class="pre">Symmetric</span></code> and <code class="docutils literal notranslate"><span class="pre">Antisymmetric</span></code> are the next simplest symmetry operations.
When a user creates an instance of the <code class="docutils literal notranslate"><span class="pre">Symmetric</span></code>/ <code class="docutils literal notranslate"><span class="pre">Antisymmetric</span></code> classes
they are stating that the modes in the resulting object are pairwise symmetric
or antisymmetric respectively.</p>
<p>The final symmetry operation is <code class="docutils literal notranslate"><span class="pre">Translation</span></code>. The inputs to a <code class="docutils literal notranslate"><span class="pre">Translation</span></code>
object are two or more <code class="docutils literal notranslate"><span class="pre">Shape</span></code> objects (<code class="docutils literal notranslate"><span class="pre">JaggedShape</span></code> and <code class="docutils literal notranslate"><span class="pre">Nested</span></code> work
too). The input objects are treated as ranges, and indicate which slices or
chips of the tensor which must have the same values. Conceptually it is
possible to specify any symmetry in this manner, but it is very tedious (<em>e.g.</em>,
specifying that an <span class="math notranslate nohighlight">\(n\)</span> by <span class="math notranslate nohighlight">\(n\)</span> matrix is symmetric using
<code class="docutils literal notranslate"><span class="pre">Translation</span></code> objects requires creating <span class="math notranslate nohighlight">\(n\choose 2\)</span> <code class="docutils literal notranslate"><span class="pre">Translation</span></code>
objects, one for every pair of symmetry related elements).</p>
</div>
<div class="section" id="proposed-apis">
<h2>Proposed APIs<a class="headerlink" href="#proposed-apis" title="Permalink to this heading"></a></h2>
<div class="section" id="constructing-permutational-symmetry-objects">
<h3>Constructing Permutational Symmetry Objects<a class="headerlink" href="#constructing-permutational-symmetry-objects" title="Permalink to this heading"></a></h3>
<p>Permutational symmetry requires minimally a rank 2 tensor. The <code class="docutils literal notranslate"><span class="pre">Symmetry</span></code>
object can still be constructed for ranks less than 2, but permutational
symmetry categories (<em>i.e.</em>, symmetric, antisymmetric, or asymmetric) can NOT
be provided to it. The relevant constructions are:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Null symmetry (no rank, no modes assigned to symmetry categories)</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>

<span class="c1">// Symmetry object for a scalar (no symmetry)</span>
<span class="n">Symmetry</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// Symmetry object for a vector (no symmetry)</span>
<span class="n">Symmetry</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Declaring non-trivial symmetric or antisymmetric tensors:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Symmetric rank 2</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">s01</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>

<span class="c1">// Antisymmetric rank 2</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">a01</span><span class="p">(</span><span class="n">Antisymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>

<span class="c1">// Totally symmetric rank 3</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">s012</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>

<span class="c1">// Modes 0 and 1 are symmetric, mode 2 has no symmetry with 0 or 1</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">s01_2</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>

<span class="c1">// Modes 0 and 2 are symmetric, mode 1 has no symmetry with 0 or 2</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">s02_1</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>

<span class="c1">// Modes 1 and 2 are symmetric, mode 0 has no symmetry with 1 or 2</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">s12_0</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>

<span class="c1">// Modes 0 and 1 are antisymmetric, mode 2 has no symmetry with 0 or 1</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">a01_2</span><span class="p">(</span><span class="n">Antisymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>

<span class="c1">// Modes 0 and 2 are antisymmetric, mode 1 has no symmetry with 0 or 2</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">a02_1</span><span class="p">(</span><span class="n">Antisymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>

<span class="c1">// Modes 1 and 2 are antisymmetric, mode 0 has no symmetry with 1 or 2</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">a12_0</span><span class="p">(</span><span class="n">Antisymmetric</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>
</pre></div>
</div>
<p>Here it should be noted that something like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Symmetry</span><span class="w"> </span><span class="nf">s01_2</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Asymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>
</pre></div>
</div>
<p>is not allowed because the first argument says that modes 0 and 1 are symmetric,
but the second one declares them asymmetric. Having to specify all of the
asymmetric pairs is tedious. Following from the declarations of scalars and
vectors, one can also provide <code class="docutils literal notranslate"><span class="pre">Symmetry</span></code> with the overall tensor rank. When
provided, <code class="docutils literal notranslate"><span class="pre">Symmetry</span></code> assumes all pairs not specified in the ctor are
asymmetric, so we could have declared <code class="docutils literal notranslate"><span class="pre">s01_2</span></code> also like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Symmetry</span><span class="w"> </span><span class="nf">s01_2</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>
</pre></div>
</div>
<p>and we can declare an asymmetric rank 2 tensor like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Symmetry</span><span class="w"> </span><span class="nf">as2</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that for declaring the <code class="docutils literal notranslate"><span class="pre">Symmetry</span></code> object for a rank <code class="docutils literal notranslate"><span class="pre">r</span></code> tensor,
specifying <code class="docutils literal notranslate"><span class="pre">r</span></code> is only necessary if <code class="docutils literal notranslate"><span class="pre">(r-1)</span></code> does not appear in a subset
(which is why it was not needed for say <code class="docutils literal notranslate"><span class="pre">s01</span></code>). Put another way, <code class="docutils literal notranslate"><span class="pre">Symmetry</span></code>
assumes a rank of <code class="docutils literal notranslate"><span class="pre">(r+1)</span></code> where <code class="docutils literal notranslate"><span class="pre">r</span></code> is the highest mode found in any of
the provided symmetry categories.</p>
<p>The remaining possible rank 3 constructions are:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Modes 0 and 1 are symmetric, modes 0 and 2 are antisymmetric</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">s01_a02</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Antisymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>

<span class="c1">// Modes 0 and 1 are symmetric, modes 1 and 2 are antisymmetric</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">s01_a12</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Antisymmetric</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>

<span class="c1">// Modes 0 and 2 are symmetric, modes 0 and 1 are antisymmetric</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">s02_a01</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">Antisymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>

<span class="c1">// Modes 0 and 2 are symmetric, modes 1 and 2 are antisymmetric</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">s02_a12</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">Antisymmetric</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>

<span class="c1">// Modes 1 and 2 are symmetric, modes 0 and 1 are antisymmetric</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">s12_a01</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">Antisymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>

<span class="c1">// Modes 1 and 2 are symmetric, modes 0 and 2 are antisymmetric</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">s12_a02</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">Antisymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>

<span class="c1">// N.B. order of symmetric and antisymmetric in constructor does not matter</span>
<span class="c1">// so the other 6 mixed symmetric/antisymmetric possibilities are the same</span>
<span class="c1">// just with Antisymmetric being the first argument and Symmetric the</span>
<span class="c1">// second.</span>

<span class="c1">// Totally antisymmetric rank 3</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">a012</span><span class="p">(</span><span class="n">Antisymmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>
</pre></div>
</div>
<p>For the special cases of totally symmetric and totally antisymmetric additional
classes exist which facilitate construction:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TotallySymmetric</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w">     </span><span class="c1">// Null totally symmetric object</span>
<span class="n">TotallySymmetric</span><span class="w"> </span><span class="nf">s0</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Totally symmetric scalar</span>
<span class="n">TotallySymmetric</span><span class="w"> </span><span class="nf">s1</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Totally symmetric vector</span>
<span class="n">TotallySymmetric</span><span class="w"> </span><span class="nf">s2</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// Totally symmetric matrix</span>
<span class="n">TotallySymmetric</span><span class="w"> </span><span class="nf">s3</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// Totally symmetric rank 3 tensor</span>

<span class="n">TotallyAntisymmetric</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">     </span><span class="c1">// Null totally symmetric object</span>
<span class="n">TotallyAntisymmetric</span><span class="w"> </span><span class="nf">a0</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Totally antisymmetric scalar</span>
<span class="n">TotallyAntisymmetric</span><span class="w"> </span><span class="nf">a1</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Totally antisymmetric vector</span>
<span class="n">TotallyAntisymmetric</span><span class="w"> </span><span class="nf">a2</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// Totally antisymmetric matrix</span>
<span class="n">TotallyAntisymmetric</span><span class="w"> </span><span class="nf">a3</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// Totally antisymmetric rank 3 tensor</span>
</pre></div>
</div>
<p>Once we consider rank 4 and higher we can also have multiple symmetric (or
antisymmetric) categories, for example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Symmetry</span><span class="w"> </span><span class="nf">s01_s23</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">});</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">Symmetric</span></code>, <code class="docutils literal notranslate"><span class="pre">Antisymmetric</span></code>, or <code class="docutils literal notranslate"><span class="pre">Asymmetric</span></code> object given <code class="docutils literal notranslate"><span class="pre">n</span></code> modes,
stands for all <code class="docutils literal notranslate"><span class="pre">n</span></code> choose 2 possible mode pairs that can be formed from the
<code class="docutils literal notranslate"><span class="pre">n</span></code> modes in it, <em>i.e.</em>, <code class="docutils literal notranslate"><span class="pre">s01_s23</span></code> is NOT the same as:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Symmetry</span><span class="w"> </span><span class="nf">s0123</span><span class="p">(</span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">});</span>
</pre></div>
</div>
<p>because <code class="docutils literal notranslate"><span class="pre">s0123</span></code> additionally has symmetries among 0 and 2, 0 and 3,
1 and 2, and 1 and 3, which are not present in <code class="docutils literal notranslate"><span class="pre">s01_s23</span></code>.</p>
</div>
<div class="section" id="constructing-symmetry-objects-with-translational-symmetry">
<h3>Constructing Symmetry Objects with Translational Symmetry<a class="headerlink" href="#constructing-symmetry-objects-with-translational-symmetry" title="Permalink to this heading"></a></h3>
<p>For specifying permutational symmetry we needed to state the modes to permute.
For translational symmetry we need to specify which blocks are equivalent:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Block 0 starts at {0,0} and ends at {10,10}</span>
<span class="c1">// Block 1 starts at {10,10} and ends at {20,20}</span>
<span class="c1">// Block 2 starts at {20,20} and ends at {30,30}</span>
<span class="n">Shape</span><span class="w"> </span><span class="n">block0</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">},</span><span class="w"> </span><span class="n">block1</span><span class="p">({</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">}),</span><span class="w"> </span><span class="n">block2</span><span class="p">({</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">});</span>

<span class="c1">// matrix where block0 is the same as block1</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">b0b1</span><span class="p">(</span><span class="n">Translation</span><span class="p">{</span><span class="n">block0</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">});</span>

<span class="c1">// matrix where block0 is the same as block1 and block2</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">b0b1b2</span><span class="p">(</span><span class="n">Translation</span><span class="p">{</span><span class="n">block0</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">});</span>

<span class="c1">// Just like permutational symmetry where only some of the modes need to</span>
<span class="c1">// be involved, we can have translational symmetry which only involves a</span>
<span class="c1">// subset of the modes. In this case we need to specify which modes the</span>
<span class="c1">// indices are associated with. The following declares a Symmetry object</span>
<span class="c1">// for a rank 3 tensor where modes 0 and 1 have translational symmetry such</span>
<span class="c1">// that the block0 slice is the same as the block1 slice</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">b0b1</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">Translation</span><span class="p">({</span><span class="n">block0</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">}));</span>
</pre></div>
</div>
<p>Translational symmetry can also be declared for more exotic ranges, such as
those involving jagged and/or nested:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Block of a jagged matrix where row 0 is 10 elements long and row 1 is 20</span>
<span class="n">JaggedShape</span><span class="w"> </span><span class="n">jblock0</span><span class="p">{</span><span class="n">Shape</span><span class="p">{</span><span class="mi">10</span><span class="p">},</span><span class="w"> </span><span class="n">Shape</span><span class="p">{</span><span class="mi">20</span><span class="p">}};</span>

<span class="c1">// Block of a jagged matrix where row 2 is 10 elements long and row 3 is 20</span>
<span class="n">JaggedShape</span><span class="w"> </span><span class="nf">jblock1</span><span class="p">({</span><span class="n">Shape</span><span class="p">{</span><span class="mi">10</span><span class="p">},</span><span class="w"> </span><span class="n">Shape</span><span class="p">{</span><span class="mi">20</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="mi">2</span><span class="p">});</span>

<span class="c1">// Symmetry for a jagged matrix where block0 and block1 must be the same</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">b0b1</span><span class="p">(</span><span class="n">Translation</span><span class="p">{</span><span class="n">jblock0</span><span class="p">,</span><span class="w"> </span><span class="n">jblock1</span><span class="p">});</span>

<span class="c1">// Outer vector 10 elements long, inner are 20</span>
<span class="n">Nested</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nblock0</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Shape</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">});</span>

<span class="c1">// Same shape, but the first index of the first inner vector is 20 not 0</span>
<span class="n">Nested</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nblock1</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">Shape</span><span class="p">({</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">}));</span>

<span class="c1">// Symmetry for a rank 4 tensor where modes 0 and 1 are nested</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">nb0nb1</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">Translation</span><span class="p">{</span><span class="n">nblock0</span><span class="p">,</span><span class="w"> </span><span class="n">nblock1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>
</pre></div>
</div>
<p>Note that the fact that <code class="docutils literal notranslate"><span class="pre">Translation</span></code> describes a symmetry operation means
that the shapes in the symmetry operations must be the same up to a translation
of the origin. The shapes will also need to be consistent with the shapes of
the respective modes of the tensor. Finally, we note that it’s possible to
combine all of these mechanisms:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// two 1 by 1 shapes, one with origin (0, 0) the other with origin (1,1)</span>
<span class="n">Shape</span><span class="w"> </span><span class="n">e00</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">e11</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>

<span class="c1">// Rank 4 tensor, slice is the same as the (1,1) slice and modes 2 and</span>
<span class="c1">// 3 are symmetric</span>
<span class="n">Symmetry</span><span class="w"> </span><span class="nf">sym</span><span class="p">(</span><span class="n">Translational</span><span class="p">({</span><span class="n">e00</span><span class="p">,</span><span class="w"> </span><span class="n">e11</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">}),</span><span class="w"> </span><span class="n">Symmetric</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-properties">
<h3>Basic Properties<a class="headerlink" href="#basic-properties" title="Permalink to this heading"></a></h3>
<p>While I have some idea of what properties will be needed, how to best expose
them is punted until I have a better idea of how they would be used under the
hood.</p>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt><a class="reference internal" href="#sym-symmetric-and-antisymmetric"><span class="std std-ref">Symmetric and antisymmetric</span></a></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">Symmetric</span></code>, <code class="docutils literal notranslate"><span class="pre">AntiSymmetric</span></code>, and <code class="docutils literal notranslate"><span class="pre">Asymmetric</span></code> classes have been
introduced to facilitate expressing permutational symmetry. Cyclic
permutation classes could be added later if needed.</p>
</dd>
<dt><a class="reference internal" href="#sym-translational-symmetry"><span class="std std-ref">Translational symmetry</span></a></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">Translation</span></code> class describes slices of the tensor which are the same.</p>
</dd>
<dt><a class="reference internal" href="#sym-basic-properties"><span class="std std-ref">Basic properties</span></a></dt><dd><p>This is one of the primary responsibilities of the <code class="docutils literal notranslate"><span class="pre">Symmetry</span></code> class.</p>
</dd>
</dl>
</div>
<div class="section" id="additional-notes">
<h2>Additional Notes<a class="headerlink" href="#additional-notes" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Can we use jagged tensors here? In particular I’m thinking an upper-triangular
matrix without the lower triangle is a jagged matrix.</p></li>
<li><p>I believe that symmetry can be completely implemented without needing to
store the tensor’s overall shape (<code class="docutils literal notranslate"><span class="pre">Translational</span></code> will need the shapes of
the blocks, but shouldn’t need the overall shape).</p></li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="shape.html" class="btn btn-neutral float-left" title="Tensor Shape Design" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sparsity.html" class="btn btn-neutral float-right" title="Tensor Sparsity Design" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, NWChemEx Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>